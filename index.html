<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>⚡ FluxCipher Code Editor</title>

  <!-- CodeMirror -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closetag.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>

  <style>
    body {
      margin:0;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg,#6a11cb,#2575fc);
      color:#fff;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:20px;
      min-height:100vh;
    }
    .container {
      background:rgba(0,0,0,0.6);
      border-radius:12px;
      padding:16px;
      width:100%;
      max-width:1100px;
      box-shadow:0 10px 30px rgba(0,0,0,0.35);
    }
    header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:12px;
    }
    h1 {margin:0;font-size:18px}
    select,button {
      padding:8px 12px;
      border-radius:8px;
      border:none;
      font-weight:600;
      cursor:pointer;
    }
    #editor {height:320px;border:1px solid #444;border-radius:8px;}
    .actions {margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}
    .btn {background:#2575fc;color:#fff}
    .btn.secondary{background:#444}
    iframe {
      width:100%;height:320px;margin-top:12px;border-radius:8px;
      border:1px solid rgba(255,255,255,0.2);background:#fff;
    }
    .error-box {
      margin-top:8px;
      background:#111;
      color:#ff6b6b;
      padding:10px;
      border-radius:8px;
      min-height:40px;
      font-family:monospace;
      white-space:pre-wrap;
    }
    footer {margin-top:12px;text-align:center;font-size:13px;color:#ddd}
    .telegram a {
      background:#0088cc;
      color:#fff;
      text-decoration:none;
      padding:8px 14px;
      border-radius:8px;
      font-weight:600;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>⚡ FluxCipher — Web Code Editor</h1>
      <div class="telegram"><a href="https://t.me/Flux_V1" target="_blank">Join Telegram</a></div>
    </header>

    <select id="langSelect">
      <option value="html">HTML</option>
      <option value="css">CSS</option>
      <option value="javascript">JavaScript</option>
    </select>

    <div id="editor"></div>

    <div class="actions">
      <button class="btn" id="runBtn">▶ Run</button>
      <button class="btn secondary" id="detectBtn">Detect Errors</button>
      <button class="btn secondary" id="fixBtn">Auto Fix</button>
      <button class="btn secondary" id="saveBtn">Save</button>
      <button class="btn secondary" id="loadBtn">Load</button>
      <button class="btn secondary" id="clearBtn">Clear</button>
      <button class="btn secondary" id="downloadBtn">Download</button>
    </div>

    <iframe id="preview" sandbox="allow-scripts allow-same-origin"></iframe>
    <div id="errors" class="error-box">NO ERRORS DETECTED</div>

    <footer>Powered by FluxCipher ⚡</footer>
  </div>

<script>
  // CodeMirror init
  let editor = CodeMirror(document.getElementById("editor"), {
    mode: "xml",
    theme: "dracula",
    lineNumbers: true,
    autoCloseTags: true,
    autoCloseBrackets: true,
    value: "<!DOCTYPE html>\n<html>\n<head>\n<title>Flux Test</title>\n</head>\n<body>\n<h1>Hello FluxCipher ⚡</h1>\n</body>\n</html>"
  });

  const preview = document.getElementById("preview");
  const errors = document.getElementById("errors");
  const langSelect = document.getElementById("langSelect");

  // Language switching
  langSelect.addEventListener("change", ()=>{
    let lang = langSelect.value;
    let mode = lang==="html"?"xml":lang;
    editor.setOption("mode", mode);
  });

  // Run button
  function runCode(){
    let code = editor.getValue();
    let lang = langSelect.value;
    let output="";
    if(lang==="html") output = code;
    if(lang==="css") output = "<style>"+code+"</style>";
    if(lang==="javascript") output = "<script>try{"+code+"}catch(e){parent.postMessage({type:'js-error',message:e.message},'*')}<\/script>";
    const doc = preview.contentWindow.document;
    doc.open();doc.write(output);doc.close();
    errors.textContent="NO ERRORS DETECTED";
  }
  document.getElementById("runBtn").addEventListener("click", runCode);

  // Error detection
  function detectErrors(){
    let lang = langSelect.value;
    let code = editor.getValue();
    let issues=[];
    try{
      if(lang==="javascript") new Function(code);
      if(lang==="css"){
        const open=(code.match(/{/g)||[]).length;
        const close=(code.match(/}/g)||[]).length;
        if(open!==close) issues.push("CSS braces mismatch { }");
      }
      if(lang==="html"){
        if(!/<html/i.test(code)) issues.push("Missing <html> tag?");
      }
    }catch(e){issues.push(e.message);}
    errors.textContent = issues.length?issues.join("\n• "):"NO ERRORS DETECTED";
  }
  document.getElementById("detectBtn").addEventListener("click", detectErrors);

  // Real-time JS error detection
  editor.on("change", ()=>{
    if(langSelect.value==="javascript"){
      try{ new Function(editor.getValue()); errors.textContent="NO ERRORS DETECTED"; }
      catch(e){ errors.textContent="Syntax Error: "+e.message; }
    }
  });

  // Auto Fix
  document.getElementById("fixBtn").addEventListener("click", ()=>{
    let code = editor.getValue();
    code = code.replace(/;\s*/g,";\n").replace(/{\s*/g,"{\n  ").replace(/\n\s*}/g,"\n}");
    editor.setValue(code);
  });

  // Save to localStorage
  document.getElementById("saveBtn").addEventListener("click", ()=>localStorage.setItem("fluxCode",editor.getValue()));
  document.getElementById("loadBtn").addEventListener("click", ()=>editor.setValue(localStorage.getItem("fluxCode")||""));
  document.getElementById("clearBtn").addEventListener("click", ()=>editor.setValue(""));

  // Download
  document.getElementById("downloadBtn").addEventListener("click", ()=>{
    const blob=new Blob([editor.getValue()],{type:"text/plain"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="fluxcipher_code.txt";
    a.click();
  });

  // Listen runtime JS errors
  window.addEventListener("message",(e)=>{
    if(e.data.type==="js-error") errors.textContent="Runtime Error: "+e.data.message;
  });

  // Auto-run on load
  setTimeout(runCode,500);
</script>
</body>
</html>
